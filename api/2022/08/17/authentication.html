<!DOCTYPE html>
<html lang="en-US">
  <head>
    

    

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <link rel="stylesheet" href="/blog/assets/css/main.css">
    <script src="https://kit.fontawesome.com/f9271f6bdd.js" crossorigin="anonymous"></script>
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github-dark-dimmed.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
  </head>

  <body class="font-mono list-disc bg-gray-700">
    <div class="pt-8 bg-gray-700">
      
        <nav class="flex flex-wrap items-center justify-center px-2 py-4 mb-6">
  <div class="titleImagePosition">
    <a href="/blog/" class="!px-0 !py-0">
      <img class="titleImage" src="/blog/assets/img/title.jpeg" alt="author profile image">
    </a>
  </div>
  <div class="flex">
    <div class="container px-4 mx-auto flex flex-wrap items-center justify-center">
      <div class="absolute right-16 flex md:block" id="navbar">
        <div class="flex flex-col md:flex-row mr-auto w-full">
          <!-- dynamic menu based on navigation info in _config.yml -->
          
             <!-- don't show current page in menu -->
              <a class="text-sm text-gray-500 hover:text-gray-900 px-3 py-2 mx-auto uppercase"
                href="/blog/about">
                About Me
              </a>
            
          
        </div>
      </div>
    </div>
  </div>
</nav>

      
      
  <div id='sidebar' class='fixed py-16 hidden lg:block'></div>
  <div id='burger-sidebar' class='pt-24 pl-4 fixed hidden md:block'></div>

<div class='prose bg-gray-400' id='article'>
  <div id='word-count' class='pt-4 pl-8 fixed'>words: 80</div>
  <div class='text-center'>
    
  </div>
  <div class='md:px-4 md:grid lg:px-72'>
    <h1 class='text-center mt-6 mb-6'>Authentication</h1>
    <h2 id="introduction">Introduction</h2>

<p>Authentication in API is a way to make sure user from client side has authorization from server side.</p>

<h2 id="why">Why?</h2>

<p>With authentication, only authorized users are able to access sensitive information or perform actions that could affect the system or its users.</p>

<h2 id="how">How?</h2>

<h3 id="json-web-tokens-jwt">JSON Web Tokens (JWT)</h3>

<p>JWT is a self-contained token that securely transmits information between parties as a JSON object. It consists of three parts: a header, a payload, and a signature.</p>
<ul>
  <li>Header contains information about the token</li>
  <li>Payload contains the claims (user information, expiration time, etc.)</li>
  <li>Signature ensures the integrity of the token. The server validates the token’s signature to verify its authenticity.</li>
</ul>

<p>The steps of JWT:</p>

<ol>
  <li>Claims: JWT consists of a set of claims encoded as a JSON object. These claims can include information about the user, such as the user’s name, ID, and roles.</li>
  <li>Encoding: The JSON object is then Base64Url encoded to produce a compact string, which is the JWT.</li>
  <li>Signature: To ensure that the information in the JWT has not been tampered with, a signature is generated using a secret key shared between the parties. The signature is calculated over the encoded JWT and is appended to it, separated by a period.</li>
  <li>Transmission: The JWT is then sent from the client to the server in the <strong>Authorization</strong> header of an HTTP request, usually as a Bearer Token.</li>
  <li>Verification: On the server, the signature is verified using the shared secret key, and if the signature is valid, the information in the JWT is trusted and can be used to perform authorized actions.</li>
</ol>

<h3 id="basic-authentication">Basic Authentication</h3>

<p>Basic Authentication involves sending the API credentials (username and password) with every request. The credentials are encoded in Base64 and sent in the request headers. However, this method is not considered secure for APIs because the credentials are sent with every request and could be intercepted if the connection is not encrypted.</p>

<p>Given we have the <a href="/blog/internet/2021/04/09/http.html">concept of HTTP</a>, client sent requests to server with key information in headers, including <code class="language-plaintext highlighter-rouge">Authorization</code> with form such as</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Authorization: Basic <span class="nv">QWxhZGRpbjpvcGVuIHNlc2FtZQ</span><span class="o">==</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Basic</code> means the method of authentication and <code class="language-plaintext highlighter-rouge">QWxhZGRpbjpvcGVuIHNlc2FtZQ==</code> is encoded on client side and going to be decoded on server side to check authorization.</p>

<p>For example, given <code class="language-plaintext highlighter-rouge">username = Aladdin</code> and <code class="language-plaintext highlighter-rouge">password = open sesame</code>, the encoding of <code class="language-plaintext highlighter-rouge">Aladdin:open sesame</code> in Base64 is <code class="language-plaintext highlighter-rouge">YWxpY2U6c3VwZXJtYW4=</code> and client will send request with authorization in header:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Authorization: Basic <span class="nv">YWxpY2U6c3VwZXJtYW4</span><span class="o">=</span>
</code></pre></div></div>

<p>Then server will decode it in Base64 and match the <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">password</code> stored in server. If the result did not match, the example response:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 401 Unauthorized
Date: Wed, 21 Oct 2015 07:28:00 GMT
WWW-Authenticate: Basic <span class="nv">realm</span><span class="o">=</span><span class="s2">"Access to staging site"</span>
</code></pre></div></div>

<ul>
  <li>pros</li>
  <li>cons
    <ul>
      <li>no session expiration mechanism, meaning once login, login in until browser cookie expires.</li>
      <li>easy algorithm to hack</li>
      <li>Replay attack (TBC)</li>
    </ul>
  </li>
</ul>

<h3 id="token-based-authentication">Token-Based Authentication</h3>

<p>Token-based authentication involves exchanging credentials (username and password) for a token from the server. This token is then used to authenticate subsequent requests. Tokens can be stored on the client-side (e.g., local storage or cookies) and sent with each request in the headers. Tokens are typically long, randomly generated strings and can have an expiration time, providing better security.</p>

<h3 id="other">other</h3>

<p>API Keys:
API keys are simple, unique strings that are used to authenticate requests. The API key is typically included in the request headers or as a query parameter. The server verifies the validity of the key before processing the request. API keys are easy to implement but provide a lower level of security as they can be compromised if not handled properly.</p>

<p>OAuth 2.0:
OAuth 2.0 is a widely adopted industry-standard protocol for authentication and authorization. It allows users to grant limited access to their resources on one website (called the “resource server”) to another website or application (called the “client”) without sharing their credentials. OAuth 2.0 involves obtaining an access token from the authorization server and using that token to make authenticated requests to the API.</p>

<h2 id="what">What?</h2>

<h3 id="jwt-in-js">JWT in JS</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">jsonwebtoken</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">SECRET_KEY</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">secret_key</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Generate a JWT</span>
<span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">John Doe</span><span class="dl">'</span> <span class="p">},</span> <span class="nx">SECRET_KEY</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">expiresIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1h</span><span class="dl">'</span>
<span class="p">});</span>

<span class="c1">// Verify a JWT</span>
<span class="kd">const</span> <span class="nx">decoded</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">SECRET_KEY</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">decoded</span><span class="p">);</span> <span class="c1">// { id: 123, name: 'John Doe', iat: 1547451138, exp: 1547454738 }</span>
</code></pre></div></div>

<ul>
  <li>we can generate SECRET_KEY with <code class="language-plaintext highlighter-rouge">crypto</code></li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">randomBytes</span><span class="p">(</span><span class="mi">32</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// secret key</span>
</code></pre></div></div>

<h2 id="reference">Reference</h2>

<p><a href="https://carsonwah.github.io/http-authentication.html">開發者必備知識 - HTTP認證（HTTP Authentication）</a></p>

  </div>
</div>

<footer class="relative px-4 pt-4 pb-4">
    <!-- footer msg -->
  <div class="flex flex-wrap items-center justify-center">
    <br>
  </div>
</footer>

      <button
        type="button"
        data-mdb-ripple="true"
        data-mdb-ripple-color="light"
        class="scrollTopBtn"
        id="btn-back-to-top"
      >
        <svg aria-hidden="true" focusable="false" data-prefix="fas" class="w-4 h-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg>
      </button>
    </div>
  </body>

  <script>
    /* Function for getting the current year in the footer */
    (function () {
      if (document.getElementById("get-current-year")) {
        document.getElementById(
          "get-current-year"
        ).innerHTML = new Date().getFullYear();
      }
    })();
    /* Function for opening navbar on mobile */
    function toggleNavbar(collapseID) {
        document.getElementById(collapseID).classList.toggle("hidden");
        document.getElementById(collapseID).classList.toggle("block");
      }
    /* Function for dropdowns */
    function openDropdown(event, dropdownID) {
      let element = event.target;
      while (element.nodeName !== "A") {
        element = element.parentNode;
      }
      document.getElementById(dropdownID).classList.toggle("hidden");
      document.getElementById(dropdownID).classList.toggle("block");
    }

    // Get the button
    let myButton = document.getElementById("btn-back-to-top");
    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function () {
      scrollFunction();
    };
    function scrollFunction() {
      if (
        document.body.scrollTop > 20 ||
        document.documentElement.scrollTop > 20
      ) {
        myButton.style.display = "block";
      } else {
        myButton.style.display = "none";
      }
    }
    // When the user clicks on the button, scroll to the top of the document
    myButton.addEventListener("click", backToTop);
    function backToTop() {
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    }
  </script>

  <script type="text/javascript" src="/blog/assets/javascript/bundle.js" charset="utf-8"></script>
</html>
