<h3 id="mail-sending">Mail Sending</h3>

<p>In rails project, generate mailer with</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rails g mailer Contact
</code></pre></div></div>
<p>and then rails will create following files:</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">app/mailers/application_mailer.rb</code> &amp; <code class="language-plaintext highlighter-rouge">contact_mailer.rb</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">app/views/layouts/mailer.html.erb</code> &amp; <code class="language-plaintext highlighter-rouge">mailer.text.erb</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">app/views/contact_mailer</code></p>
  </li>
</ol>

<p><strong>The concept of mailer is similar to controller and view. Let’s explore more to those files created.</strong></p>

<h4 id="application_mailerrb"><strong>application_mailer.rb:</strong></h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class ApplicationMailer &lt; ActionMailer::Base  
  default from: 'from@example.com'
  layout 'mailer'  
end
</code></pre></div></div>
<p>The concept of this file:</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">default from: 'from@example.com'</code> means by default, the mail will be sent by from@example.com</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">layout 'mailer'</code> means by default, it will find the template, <code class="language-plaintext highlighter-rouge">mailer.html.erb</code></p>
  </li>
</ol>

<h4 id="contact_mailerrb"><strong>contact_mailer.rb:</strong></h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class ContactMailer &lt; ApplicationMailer  
end
</code></pre></div></div>
<p>Just like how controller connect to views, the method name in controller is by default the same as the html file name; for example, we create following method in <code class="language-plaintext highlighter-rouge">contact_mailer.rb</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class ContactMailer &lt; ApplicationMailer  
  def say_hello_to(user)  
    @user = user  
    mail to: @user.email, subject:"Hello!!"  
  end  
end
</code></pre></div></div>
<p>Then the method will try to find <code class="language-plaintext highlighter-rouge">say_hello_to.html.erb</code> in <code class="language-plaintext highlighter-rouge">views/contact_mailer</code></p>

<h4 id="viewscontact_mailersay_hello_tohtmlerb">views/contact_mailer/say_hello_to.html.erb</h4>

<p>The text in this file will be the context of the email that the system is going to send</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%= @user.name %&gt;,Hello:

Have a nice day!~
</code></pre></div></div>
<h3 id="then-how-did-the-mailsent">Then how did the mail sent?</h3>

<p>By default, there is no specific webpage for mail sending. The mail sending process should be attached on the methods created; for example, if we want to send mail every time we create a user, we should add the following in the method, <code class="language-plaintext highlighter-rouge">create</code> of user controller</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class UsersController &lt; ApplicationController  
  ...

  def create  
    @user = User.new(user_params)  
    if @user.save  
      ContactMailer.say_hello_to(@user).deliver_now  
      redirect_to @user, notice: 'User was successfully created.'  
    else  
      render :new  
    end  
  end

  ...

end
</code></pre></div></div>
<p>The coding <code class="language-plaintext highlighter-rouge">ConcactMailer.say_hello_to(@user).deliver_now</code> means it call the method to send say hello after creating user and the mail is the input mail in user creating method.</p>

<p>We should add the user before testing, please generate user first.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rails generate scaffold User name:string email:string tel:string
</code></pre></div></div>
<p>and then do migration</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rails db:migrate
</code></pre></div></div>
<h3 id="third-party-packagemailgun">Third Party Package: <a href="https://www.mailgun.com/">Mailgun</a></h3>

<p>We may need third party professional package to send the email. In Mailgun, get the domain for mail sending. With this domain, we can send the email with its <a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol">smtp (simple mail transfer protocol)</a> server. The <a href="https://support.cloudways.com/configure-mailgun-smtp/">way to get domain in mailgun.</a> After the steps to set up mailgun, add the following in <code class="language-plaintext highlighter-rouge">config/environments/development.rb</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Rails.application.configure do  
    
  ...

  # add the following SMTP setup  
  config.action_mailer.delivery_method = :smtp  
  config.action_mailer.smtp_settings = {  
    address: 'smtp.mailgun.org',  
    port: 587,  
    domain: 'any_domain_name',  
    user_name: 'user_name_from_mailgun',  
    password: 'password_from_mailgun',  
    authentication: 'plain',  
    enable_starttls_auto: true  
  }  
end
</code></pre></div></div>
<p>After creating users, in mailgun dashboard, we can check whether mail sent in mailgun API.
<img src="/assets/img/1__tjoMode96kMVQdhLZlhYXA.png" alt="" /></p>

<h3 id="reference">Reference</h3>

<p><a href="https://railsbook.tw/">https://railsbook.tw/</a></p>
