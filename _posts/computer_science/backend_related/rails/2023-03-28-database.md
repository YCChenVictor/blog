---
layout: post
title:
description: ''
date: '2023-03-28'
categories: rails
note:
mathjax:
mermaid:
p5:
threeJS:
anchor:
publish: true
---

## Introduction

There are several topics in rails related to database:

* Database migrations: Manage changes to the database schema. Migrations are written in Ruby and allow you to make changes to the database schema while keeping track of the changes over time.
* Associations: Allow you to define relationships between different database tables. For example, a user may have many blog posts, and each blog post belongs to a user.
* Querying: Rails provides a query interface called ActiveRecord::Relation, which allows you to build and execute database queries. This interface is based on a fluent API, which makes it easy to chain query methods and build complex queries.
  * Indexing: Indexes are used to speed up database queries by creating a data structure that allows for fast lookups. In Rails, you can create indexes on specific columns in your database tables to optimize query performance.
* Validations: Validations allow you to define constraints on the data stored in your database. For example, you can validate that a user's email address is unique or that a password meets certain complexity requirements.

## Why?

Because web application framework relies heavily on databases to store and manage application data.

* Databases play a critical role in storing, managing, and retrieving data that is used by web applications. They provide a structured way to store and organize data, allowing web applications to scale and handle large amounts of data efficiently.
* Learning how to work with databases in Ruby on Rails is essential for building effective web applications that can handle large amounts of data and scale to meet the needs of users. A strong understanding of database concepts and best practices will enable developers to design and build robust, reliable, and scalable Rails applications.

## How?

### Migration

A typical migration file:

```ruby
class AddAgeToUsers < ActiveRecord::Migration[6.0]
  def up
    add_column :users, :age, :integer
  end

  def down
    remove_column :users, :age
  end
end
```

* Ruby file that contains two methods: up and down
  * Up method is used to define the changes you want to make to the database schema
  * Down method is used to define how to undo those changes
* Migration is like version control of database
* Any changes related to database schema will be recorded in migrations with Ruby DSL * The summary of the changes of migration is in `schema.rb`

To run migration:

```bash
rails db:migrate
```

To undo:

```bash
rails db:rollback
```

There are not only `add_column` and `remove_column` but also

* create_table - creates a new database table
* drop_table - drops an existing database table
* rename_table - renames an existing database table
* add_column - adds a new column to an existing database table
* remove_column - removes a column from an existing database table
* rename_column - renames a column in an existing database table
* change_column - changes the data type or options of a column in an existing database table
* add_index - adds a new index to a database table
* remove_index - removes an existing index from a database table
* execute - executes a custom SQL statement
* add_reference - adds a foreign key reference to an existing database table
* remove_reference - removes a foreign key reference from an existing database table
* change_table - allows you to make multiple changes to an existing database table in a single migration
* reversible - creates a reversible migration that can be rolled back
* up - defines the changes to be made to the database schema when the migration is run
* down - defines how to revert the changes made by the migration

### Associations

With the `add_reference`, we can add association to two tables. One-to-many association between a User model and a Post model using migration files:

```ruby
class AddUserRefToPosts < ActiveRecord::Migration[6.0]
  def change
    add_reference :posts, :user, null: false, foreign_key: true
  end
end
```

* `add_reference` adds a new column called user_id to the posts table
* `:user` tells Rails this column should be a foreign key reference to the User model
* `null: false` ensures that every post must belong to a user
* `foreign_key: true` enforces referential integrity

By using migration files to establish associations between models, you can ensure that your database schema is consistent and follows best practices for data modeling. You can also take advantage of Rails' powerful query interface to query data across multiple tables using associations.

Remember to declare `has_many` and `belongs_to` on `User` and `Post`

### querying

Time is money, how to query fast plays key role. Try to understand how to query in rails with [ActiveRecord Query Interface](https://guides.rubyonrails.org/active_record_querying.html). ActiveRecord uses ORM.

Learn about performance and optimization: As your application grows, it's important to be mindful of performance and optimization. You can use tools like the Rails log and the explain method to identify slow queries and optimize them for better performance.

## What?

give real world example

## Reference
