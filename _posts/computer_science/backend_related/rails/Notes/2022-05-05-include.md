---
layout: post
title:
description: ''
date: '2022-05-05'
categories: rails
note:
mathjax:
mermaid:
p5:
threeJS:
anchor:
publish: true
---

## Introduction

In Rails ORM (Object-Relational Mapping), the include method is used to eager load associated records. It is often used to avoid the [N+1 query problem]({{site.baseurl}}/database/2022/08/12/N+1.html), which occurs when an application issues too many SQL queries to retrieve associated records. By eager loading associations, you can reduce the number of SQL queries and improve performance.

Here's an example of how to use include in Rails ORM:

```ruby
class Post < ApplicationRecord
  has_many :comments
end

class Comment < ApplicationRecord
  belongs_to :post
end
```

If we want to retrieve all posts and their associated comments, we can use the includes method to eager load the comments:

```ruby
@posts = Post.(:comments)
```

This will load all posts and their associated comments in a **single query**, rather than issuing a separate query for each post's comments.

In addition to includes, Rails ORM also provides other methods for eager loading associations, such as joins and preload. The choice of which method to use depends on the specific use case and performance considerations.

Eager loading associations can significantly improve the performance of your Rails application, especially when dealing with large datasets. However, it's important to use it judiciously and avoid overloading your queries with unnecessary associations.

## Why

focus on why we need it

## How

### condition

Take above include as example, we can set condition with chaining as follow:

```ruby
@posts = Post.includes(comments: [:user]).where(comments: { approved: true }, users: { admin: true })
```

include = preload + eager_load

## What

Give a real world example

## Reference

[Improving Database performance and overcoming common N+1 issues in Active Record using includes, preload, eager_load, pluck, select, exists?](https://blog.saeloun.com/2020/01/08/activerecord-database-performance-n-1-includes-preload-eager-load-pluck.html)
