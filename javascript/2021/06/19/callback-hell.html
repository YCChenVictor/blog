<!DOCTYPE html>
<html lang="en-US">
  <head>
    <!-- 3D drawing -->
    
    <!-- 2D drawing -->
    
    <!-- for mathjax support -->
    
    <!-- mermaid --><meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="/blog/assets/css/main.css">
    <script src="https://kit.fontawesome.com/f9271f6bdd.js" crossorigin="anonymous"></script>
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github-dark-dimmed.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
  </head>

  <body class="font-mono list-disc">
    <div class="pt-12 pb-4">
      
        <nav class="flex flex-wrap items-center justify-center px-2 mb-6">
  <div class="container px-4 mx-auto flex flex-wrap items-center justify-center">
    <div class="w-full relative flex justify-center">
      <button type="button" onclick="toggleNavbar('navbar')"
        class="rounded-md inline-flex items-center justify-center text-gray-500 md:hidden"
        aria-expanded="false">
        <span class="sr-only">Open menu</span>
        <!-- Heroicon name: outline/menu -->
        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
          stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>

    <div class="flex hidden md:block" id="navbar">
      <div class="flex flex-col md:flex-row mr-auto w-full">
         <!-- don't show Home in menu for Homepage -->
        <a class="text-sm text-gray-500 hover:text-gray-900 px-3 py-2 lg:py-1 mx-auto uppercase"
          href="/blog/">
          Home
        </a>
        

      <!-- dynamic menu based on navigation info in _config.yml -->
      
         <!-- don't show current page in menu -->
        <a class="text-sm text-gray-500 hover:text-gray-900 px-3 py-2 lg:py-1 mx-auto uppercase"
          href="/blog/about">
          About
        </a>
        
      
         <!-- don't show current page in menu -->
        <a class="text-sm text-gray-500 hover:text-gray-900 px-3 py-2 lg:py-1 mx-auto uppercase"
          href="/blog/category">
          Category
        </a>
        
      
    </div>
    </div>
  </div>
</nav>
        <div id="sidebar" class="p-4 fixed"></div>
      
      <div class="px-4 pt-4 prose prose-indigo">
  <h1 class="text-center mt-6 mb-6">(JavaScript 3) Callback Hell, Promise, and Async/Await</h1>
  <div class="text-center">
    
  </div>
  <div class="px-72">
    <h2 id="introduction--why">Introduction &amp; Why</h2>
<p>The concept of Async: letting some steps be skipped and do it latter once conditions matched. Asynchronous programming is common in javascript, because the process of rendering data from server takes time and we do not want our page to be stalled. To achieve it, we use callback function.</p>

<h2 id="how">How</h2>
<p>For example, thinking of my webpage is the burger store and I serve burgers. The ingredients are simply as follow: sauce, patty, lettuce. The chef(backend) needs time to prepare the ingredients. One second for lettuce cutting, two seconds for patty slicing, and three seconds for sauce cooking. I use <code class="language-plaintext highlighter-rouge">setTimeout()</code> to simulate the delivery time from backend. The Chef can cut and slice while the sauce is boiled. Then the coding may be as follow:</p>

<h3 id="indexhtml">index.html</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;Document&lt;/title&gt;
  &lt;script&gt;main.js&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div></div>

<h3 id="mainjs">main.js</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const ingredients = [
  'buns'
]

serveBurger()
createIngredient({ name: 'sauce', time: 3000 })
createIngredient({ name: 'patty', time: 2000 })
createIngredient({ name: 'lettuce', time: 1000 })

function serveBurger() {
  setTimeout(() =&gt; {
    let burger = '';
    ingredients.forEach((ingredient) =&gt; {
      burger += `&lt;ul&gt;${ingredient}&lt;/ul&gt;`
    });
    document.body.innerHTML = burger;
  }, 4000)
}

function createIngredient(ingredient) {
  setTimeout(() =&gt; {
    ingredients.push(ingredient.name)
  }, ingredient.time)
}
</code></pre></div></div>
<p>Then the burger looks like</p>

<p><img src="/assets/img/burger.png" alt="" width="500" /></p>

<p>However, what if we do not know how much time each ingredient takes, meaning the waiter may go to get the meal too early and may serve Semi-finished products if the chef did not notice; for example, taking the 4000 out from the setTimout() in the function, serveBurger.</p>

<p>We need callback function to help us. With callback function, we can tell the waiter back after the burger prepared; for example, we call the waiter back every 0.5 second and check whether ingredients prepared. The code:</p>
<h3 id="js">js</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const requiredIngredients = ['lettuce', 'patty', 'sauce']

const ingredients = [
  'buns'
]

const recipes = [
  { name: 'lettuce', time: 1000 },
  { name: 'patty', time: 2000 },
  { name: 'sauce', time: 3000 }
]

for (let i = 0; i &lt; requiredIngredients.length; i++) {
  createIngredient(recipes[i], () =&gt; {
    checkIngredients(() =&gt; {
      serveBurger()
    })
  })
}

function checkIngredients(callback) {
  setTimeout(() =&gt; {
    if (requiredIngredients.every(result =&gt; ingredients.includes(result))) {
      callback()
    } else {
      console.log("still preparing")
    }
  }, 500)
}

function serveBurger() {
  setTimeout(() =&gt; {
    let burger = '';
    ingredients.forEach((ingredient) =&gt; {
      burger += `&lt;ul&gt;${ingredient}&lt;/ul&gt;`
    });
    document.body.innerHTML = burger;
  })
}

function createIngredient(ingredient, callback) {
  setTimeout(() =&gt; {
    ingredients.push(ingredient.name);
    callback()
  }, ingredient.time)
}
</code></pre></div></div>
<p>As you can see, there is some callbacks looks like</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>createIngredient(recipes[i], () =&gt; {
  checkIngredients(() =&gt; {
    serveBurger()
  })
})
</code></pre></div></div>
<p>As you can see, the more steps to wait, the more callbacks would be, making the code looks like boomerang and this is called the <strong>callback hell</strong>. To solve this kind of issue, we can use <strong>promise</strong></p>

<h3 id="promise">Promise</h3>
<p>I am going to solve the callback part in the callback hell. With promise, we can eliminate callback from the function first. For example, the checkIngredient(), changing from</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function createIngredient(ingredient, callback) {
  setTimeout(() =&gt; {
    ingredients.push(ingredient.name);
    callback()
  }, ingredient.time)
}
</code></pre></div></div>
<p>to</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function createIngredient(ingredient) {
  return new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
      ingredients.push(ingredient.name);
      
      const error = true
      if (!error) {
        resolve();
      } else {
        reject(`Error: Something went wrong while creating ingredient, ${ ingredient.name }`)
      }

    }, ingredient.time)
  })
}
</code></pre></div></div>
<p>and eliminate callback() from checkIngredients with same technique. Then, the callback hell structure, changing from</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>createIngredient(recipes[i], () =&gt; {
  checkIngredients(() =&gt; {
    serveBurger()
  })
})
</code></pre></div></div>
<p>to</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>createIngredient(recipes[i])
  .then(checkIngredients)
  .then(serveBurger)
  .catch(error =&gt; console.log(error))
</code></pre></div></div>
<p>However, there is still a hell like chain structure, so I am going to use async/await.</p>

<h3 id="asyncawait">Async/Await</h3>
<p>With the promise function defined above, we can turn the chain structure into</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>async function step(recipe) {
  await createIngredient(recipe).catch(error)
  await checkIngredients()
  serveBurger()
}
</code></pre></div></div>
<p>and call them with</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for (let i = 0; i &lt; requiredIngredients.length; i++) {
  step(recipes[i]);
}
</code></pre></div></div>

<h2 id="reference">Reference</h2>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises"><strong>Using Promise (MDN)</strong></a></p>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><strong>Promise (MDN)</strong></a></p>

<p><a href="https://www.youtube.com/watch?v=PoRJizFvM7s"><strong>Async JS Crash Course - Callbacks, Promises, Async Await</strong></a></p>

  </div>
</div>

<footer class="relative px-4 pt-4 pb-4">
  
  <!-- divider -->
  <div class="relative my-8">
    <div class="absolute inset-0 flex items-center" aria-hidden="true">
      <div class="w-full border-t border-gray-200"></div>
    </div>
    <div class="relative flex justify-center ">
      <span class="bg-white px-2 text-gray-200">
        <i class="text-xs far fa-square"></i>
      </span>
    </div>
  </div>

  <!-- footer msg -->
  <div class="flex flex-wrap items-center justify-center">
    <div class="text-sm text-gray-300">
      © <span id="get-current-year"></span>
      
      <a href="" class="!no-underline">
        
      </a>
      
    </div>
  </div>
  </div>
</footer>

<script type="text/javascript" src="/assets/javascripts/bundle.js" charset="utf-8"></script>

    </div>
  </body>

  <script>
    /* Funtion for getting the current year in the footer */
    (function () {
      if (document.getElementById("get-current-year")) {
        document.getElementById(
          "get-current-year"
        ).innerHTML = new Date().getFullYear();
      }
    })();

    /* Function for opning navbar on mobile */
    function toggleNavbar(collapseID) {
        document.getElementById(collapseID).classList.toggle("hidden");
        document.getElementById(collapseID).classList.toggle("block");
      }
      /* Function for dropdowns */
      function openDropdown(event, dropdownID) {
        let element = event.target;
        while (element.nodeName !== "A") {
          element = element.parentNode;
        }
        document.getElementById(dropdownID).classList.toggle("hidden");
        document.getElementById(dropdownID).classList.toggle("block");
      }
  </script>
</html>
