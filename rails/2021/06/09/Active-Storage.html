<!DOCTYPE html>
<html lang="en-US">
  <head>
    <!-- 3D drawing -->
    
    <!-- 2D drawing -->
    
    <!-- for mathjax support -->
    
    <!-- mermaid --><meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <link rel="stylesheet" href="/blog/assets/css/main.css">
    <script src="https://kit.fontawesome.com/f9271f6bdd.js" crossorigin="anonymous"></script>
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github-dark-dimmed.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
  </head>

  <body class="font-mono list-disc bg-gray-700">
    <div class="pt-8 bg-gray-700">
      
        <nav class="flex flex-wrap items-center justify-center px-2 py-4 mb-6">
  <div class="titleImagePosition">
    <a href="/blog/">
      <img class="titleImage" src="/blog/assets/img/title.jpeg" alt="author profile image">
    </a>
  </div>
  <div class="flex">
    <div class="container px-4 mx-auto flex flex-wrap items-center justify-center">
      <div class="absolute right-16 flex md:block" id="navbar">
        <div class="flex flex-col md:flex-row mr-auto w-full">
          <!-- dynamic menu based on navigation info in _config.yml -->
          
             <!-- don't show current page in menu -->
              <a class="text-sm text-gray-500 hover:text-gray-900 px-3 py-2 mx-auto uppercase"
                href="/blog/about">
                About Me
              </a>
            
          
        </div>
      </div>
    </div>
  </div>
</nav>

      
      
  <div id='sidebar' class='fixed py-16'></div>
  <div id='burger-sidebar' class='pt-24 pl-4 fixed'></div>

<div class='p-16 prose bg-gray-600'>
  <div class='text-center'>
    
  </div>
  <div class='md:px-4 md:grid lg:px-72'>
    <h1 class='text-center mt-6 mb-6'>(Rails 26) Active Storage</h1>
    <h3 id="introduction">Introduction</h3>

<p>Active Storage can attach files to objects in ORM and do not need to add a new column to table. All the attached files are put on a table called <code class="language-plaintext highlighter-rouge">active_storage_blobs</code>. Because we do not need the files to have relations with other tables, putting all of them on a table and labeling the connection of the subject works totally fine.</p>

<h3 id="why">Why</h3>

<p>With it, we do not need to create a new column in each table, requiring the same data; for example, comments and thumbnail attached and because sometimes it is inferior compared to the subject it attached, we can move them to cloud based services such as Amazon S3, Google Cloud Storage, or Microsoft Azure and only keep the main subject on local storage.</p>

<h3 id="how">How</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem ‘image_processing’, ‘~&gt; 1.2’
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">has_one_attached</code> is the grammar of active storage</p>

<p>with <code class="language-plaintext highlighter-rouge">has_one_attached</code>, we can actively upload and store data with third-party cloud services such as AWS …etc.</p>

<p>With Active Storage, in <code class="language-plaintext highlighter-rouge">erb</code> files, in <code class="language-plaintext highlighter-rouge">url_for</code>, <code class="language-plaintext highlighter-rouge">link_to</code>, <code class="language-plaintext highlighter-rouge">image_tag</code>, input the variable, rails can show the file in html.</p>

<p>Suppose we have already used active storage to save an image with following active storage in model, <code class="language-plaintext highlighter-rouge">Product</code>, </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Product &lt; ApplicationRecord

  ...  
  has_one_attached :thumbnail  
  ...

end
</code></pre></div></div>

<p>then if we want to show this image in view, there are three method:</p>

<h4 id="image_tag-example">image_tag example</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>image_tag @image.file
</code></pre></div></div>

<h3 id="to-be-continued">to be continued</h3>
<h4 id="url_for-example">url_for example</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%= url_for(product.thumbnail) %&gt;
</code></pre></div></div>

<h4 id="link_to-example">link_to example</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%= link_to document.filename %&gt;
</code></pre></div></div>

<h3 id="what">What</h3>
<p><a href="https://github.com/YCChenVictor/marketplace">Example</a></p>

<h3 id="reference">Reference</h3>

<p><a href="https://edgeguides.rubyonrails.org/active_storage_overview.html" title="https://edgeguides.rubyonrails.org/active_storage_overview.html"><strong>Active Storage Overview - Ruby on Rails Guides</strong></a><a href="https://edgeguides.rubyonrails.org/active_storage_overview.html"></a></p>

<p><a href="https://5xruby.tw/posts/active-storage-review" title="https://5xruby.tw/posts/active-storage-review"><strong>Active Storage 開箱文</strong></a><a href="https://5xruby.tw/posts/active-storage-review"></a></p>

  </div>
</div>

<footer class="relative px-4 pt-4 pb-4">
    <!-- footer msg -->
  <div class="flex flex-wrap items-center justify-center">
    <br>
  </div>
</footer>

      <button
        type="button"
        data-mdb-ripple="true"
        data-mdb-ripple-color="light"
        class="scrollTopBtn"
        id="btn-back-to-top"
      >
        <svg aria-hidden="true" focusable="false" data-prefix="fas" class="w-4 h-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg>
      </button>
    </div>
  </body>

  <script>
    /* Function for getting the current year in the footer */
    (function () {
      if (document.getElementById("get-current-year")) {
        document.getElementById(
          "get-current-year"
        ).innerHTML = new Date().getFullYear();
      }
    })();
    /* Function for opening navbar on mobile */
    function toggleNavbar(collapseID) {
        document.getElementById(collapseID).classList.toggle("hidden");
        document.getElementById(collapseID).classList.toggle("block");
      }
    /* Function for dropdowns */
    function openDropdown(event, dropdownID) {
      let element = event.target;
      while (element.nodeName !== "A") {
        element = element.parentNode;
      }
      document.getElementById(dropdownID).classList.toggle("hidden");
      document.getElementById(dropdownID).classList.toggle("block");
    }

    // Get the button
    let myButton = document.getElementById("btn-back-to-top");
    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function () {
      scrollFunction();
    };
    function scrollFunction() {
      if (
        document.body.scrollTop > 20 ||
        document.documentElement.scrollTop > 20
      ) {
        myButton.style.display = "block";
      } else {
        myButton.style.display = "none";
      }
    }
    // When the user clicks on the button, scroll to the top of the document
    myButton.addEventListener("click", backToTop);
    function backToTop() {
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    }
  </script>

  <script type="text/javascript" src="/blog/assets/javascript/bundle.js" charset="utf-8"></script>
</html>
