<!DOCTYPE html>
<html lang="en-US">
  <head>
    

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <link rel="stylesheet" href="/blog/assets/css/main.css">
    <script src="https://kit.fontawesome.com/f9271f6bdd.js" crossorigin="anonymous"></script>
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github-dark-dimmed.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
  </head>

  <body class="font-mono list-disc bg-gray-700">
    <div class="pt-8 bg-gray-700">
      
        <nav class="flex flex-wrap items-center justify-center px-2 py-4 mb-6">
  <div class="titleImagePosition">
    <a href="/blog/" class="!px-0 !py-0">
      <img class="titleImage" src="/blog/assets/img/title.jpeg" alt="author profile image">
    </a>
  </div>
</nav>

      
      
  
    <div id='sidebar' class='fixed py-16 hidden lg:block'></div>
    <div id='burger-sidebar' class='pt-24 pl-4 fixed hidden md:block'></div>
  

  <div class='prose bg-gray-400' id='article'>
    <div id='word-count' class='pt-4 pl-8 fixed'>words: 80</div>
    <div class='text-center'>
      
    </div>
    <div class='md:px-4 md:grid lg:px-72'>
      <h1 class='text-center mt-6 mb-6'>Node</h1>
      <h2 id="introduction">Introduction</h2>

<p>This article describes how to setup baseline node app.</p>

<h2 id="why">Why?</h2>

<ul>
  <li>Node: real-time, high-performance, and scalable network applications.</li>
  <li>Rails: convention -&gt; easier to code &amp; build app quicker</li>
</ul>

<h2 id="how">How?</h2>

<h3 id="init">init</h3>

<ul>
  <li>Install dependencies
    <ul>
      <li>Code
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>express pg dotenv axios bcrypt
npm <span class="nb">install </span>nodemon debug <span class="nt">--save-dev</span>
</code></pre></div>        </div>
      </li>
      <li>Explanation
        <ul>
          <li>express:</li>
          <li>pg: the package to connect to a PostgreSQL database</li>
          <li>dotenv: allows you to load environment variables from a .env file</li>
          <li>axios: a popular package for making HTTP requests, including GET and POST</li>
          <li>bcrypt: a library for hashing and salting passwords</li>
          <li>Development &amp; test
            <ul>
              <li>nodemon: a development utility that automatically restarts the server whenever changes are made to the code</li>
              <li>debug: a package that provides a simple debugging utility</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Initialize
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>my-project
<span class="nb">cd </span>my-project
npm init <span class="nt">-y</span>
</code></pre></div>    </div>
  </li>
  <li>add <code class="language-plaintext highlighter-rouge">.gitignore</code> with
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dependency directories</span>
node_modules/
  
<span class="c"># Optional npm cache directory</span>
.npm
  
<span class="c"># dotenv environment variables file</span>
.env
</code></pre></div>    </div>
  </li>
  <li>env: In <code class="language-plaintext highlighter-rouge">./.env</code>, we can add environment variables we want; for example, how to connect development database …etc
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">xxx</span>
</code></pre></div>    </div>
  </li>
  <li>ES (import &amp; export): <a href="/blog/javascript/2023/04/06/import-export.html">import and export</a></li>
  <li>Add <code class="language-plaintext highlighter-rouge">server.js</code>
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// init</span>
<span class="k">import</span> <span class="nx">express</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">express</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
  
<span class="c1">// parse body</span>
<span class="k">import</span> <span class="nx">bodyParser</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">body-parser</span><span class="dl">'</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
  
<span class="c1">// passport</span>
<span class="k">import</span> <span class="nx">passport</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./middleware/passport.js</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">passport</span><span class="p">.</span><span class="nx">initialize</span><span class="p">());</span>
  
<span class="c1">// cors</span>
<span class="k">import</span> <span class="nx">cors</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./middleware/cors.js</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">);</span>
  
<span class="c1">// API</span>
<span class="k">import</span> <span class="nx">api</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./apis/api_summary.js</span><span class="dl">'</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">api</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">api</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// TODO for production</span>
<span class="p">}</span>
  
<span class="k">export</span> <span class="k">default</span> <span class="nx">app</span>
</code></pre></div>    </div>
  </li>
  <li>package.json
    <pre><code class="language-JSON">"scripts": {
  "test": "NODE_ENV=test jest",
  "dev": "NODE_ENV=development npx nodemon server.js",
  "debug": "npx nodemon --inspect-brk server.js"
},
</code></pre>
  </li>
  <li>server
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">NODE_ENV</span><span class="o">=</span>development npx nodemon server.js
</code></pre></div>    </div>
  </li>
  <li>test it with curl: <code class="language-plaintext highlighter-rouge">curl http://localhost:5000/</code></li>
</ul>

<h3 id="structure">structure</h3>

<p>This is what I prefer</p>

<ul>
  <li>node app
    <ul>
      <li>test</li>
      <li>api</li>
      <li>configs</li>
      <li>models</li>
      <li>database
        <ul>
          <li>migrations</li>
        </ul>
      </li>
      <li>middleware</li>
      <li>services
        <ul>
          <li>sign in and sign up</li>
        </ul>
      </li>
      <li>server.js (core file to start the app)</li>
    </ul>
  </li>
</ul>

<h3 id="api">API</h3>

<p>The API of Node.js provides a comprehensive set of functions and modules that enable developers to build scalable and efficient network applications. It offers features such as file system operations, networking capabilities, event-driven programming, and support for various protocols, making it a powerful tool for server-side development. For more information, please refer to <a href="/blog/node/2022/01/26/api.html">API</a></p>

<h3 id="database">Database</h3>

<p>Set up a database and models for a node project using PG and Sequelize. The process involves creating a database, installing Sequelize, configuring it using a .sequelizerc file and a config.js file, generating a migration file for the models, and migrating the database. For more information, please refer to <a href="/blog/node/2022/12/30/database.html">database</a>.</p>

<h3 id="service">Service</h3>

<p>In Node.js, a service module can be a self-contained piece of code that performs a specific task or set of tasks, such as communicating with an external API, handling database interactions, or performing complex business logic. For more information, please refer to <a href="">service</a></p>

<h3 id="model">Model</h3>

<p>Various libraries and frameworks such as Mongoose, Sequelize, or Bookshelf can be used to implement models in Node.js, providing an ORM layer for interacting with databases and managing data models. For more information, please refer to <a href="/blog/node/2022/01/20/model.html">model</a></p>

<h3 id="spec">spec</h3>

<p>In Node.js, writing tests using a testing specification or methodology is essential for ensuring code quality and preventing bugs. Jest is a widely-used testing framework that supports several testing styles and formats and is a great choice for Node.js developers looking for a powerful and easy-to-use testing framework. For more information, please refer to <a href="/blog/node/2023/01/20/spec.html">spec</a></p>

<h3 id="debugger">debugger</h3>

<h4 id="project">project</h4>

<p>In <code class="language-plaintext highlighter-rouge">package.json</code>,</p>

<pre><code class="language-JSON">"scripts": {
  "debug": "NODE_ENV=test npx nodemon --inspect-brk server.js",
}
</code></pre>

<p>and run debug with</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run debug
</code></pre></div></div>

<p>and in chrome, enter <code class="language-plaintext highlighter-rouge">chrome://inspect</code> and then click “inspect”</p>

<h4 id="console">console</h4>

<p>The better way is to use vscode.</p>

<p>open command palette with Command + Shift + P and then input</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Debug: JavaScript Debug Terminal
</code></pre></div></div>

<p>In the terminal, input</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">test</span> <span class="nt">--watch</span> <span class="c"># for jest</span>
<span class="c"># or</span>
node xxx.js <span class="c"># for plain script</span>
</code></pre></div></div>

<p>Then we can debug the code in [debug console]</p>

<h3 id="file">File</h3>

<ul>
  <li>store</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Sample JSON data</span>
<span class="kd">const</span> <span class="nx">myData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">John</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">age</span><span class="dl">"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">city</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">New York</span><span class="dl">"</span>
<span class="p">};</span>

<span class="c1">// Convert JSON data to a string</span>
<span class="kd">const</span> <span class="nx">jsonString</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">myData</span><span class="p">);</span>

<span class="c1">// Write the JSON data to a file</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">myData.json</span><span class="dl">'</span><span class="p">,</span> <span class="nx">jsonString</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Saved!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<ul>
  <li>read</li>
</ul>

<h2 id="what">What?</h2>

<ul>
  <li><a href="/blog/node/2022/12/31/sign-up-and-login.html">passport for sign up and login</a></li>
</ul>

<h2 id="other">Other</h2>

<h4 id="import-and-export">Import and Export</h4>

<p>Whether to use import or require() in Node.js project depends on the version of Node.js and personal preference for code style and syntax, with import being advantageous for newer versions of Node.js, while require() may be preferred for backwards compatibility and certain package compatibility.</p>

<h2 id="reference">Reference</h2>

<p><a href="https://stackoverflow.com/questions/59681974/how-to-organize-routes-in-nodejs-express-app">How to organize routes in Nodejs Express app</a></p>

<p><a href="https://dev.to/dallington256/how-to-use-env-file-in-nodejs-578h">How to use .env file in node.js</a></p>

<p><a href="https://sequelize.org/docs/v6/core-concepts/model-querying-finders/">Model Querying - Finders</a></p>

<p><a href="https://jestjs.io/docs/troubleshooting">jest debug</a></p>

<p><a href="https://www.youtube.com/watch?v=IDjF6-s1hGk">Mocking a Database in Node with Jest</a></p>

<p><a href="https://nodejs.org/api/http.html">Node.js v19.5.0 documentation</a></p>

<p><a href="https://pjchender.dev/npm/npm-passport/">npm Passport 筆記（Learn to Use Passport JS）</a></p>

<p><a href="https://blog.logrocket.com/password-hashing-node-js-bcrypt/">Password hashing in Node.js with bcrypt</a></p>

    </div>
  </div>

  <footer class="relative px-4 pt-4 pb-4">
    <!-- footer msg -->
  <div class="flex flex-wrap items-center justify-center">
    <br>
  </div>
</footer>


      <button
        type="button"
        data-mdb-ripple="true"
        data-mdb-ripple-color="light"
        class="scrollTopBtn"
        id="btn-back-to-top"
      >
        <svg aria-hidden="true" focusable="false" data-prefix="fas" class="w-4 h-4" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg>
      </button>
    </div>
  </body>

  <script>
    /* Function for getting the current year in the footer */
    (function () {
      if (document.getElementById("get-current-year")) {
        document.getElementById(
          "get-current-year"
        ).innerHTML = new Date().getFullYear();
      }
    })();
    /* Function for opening navbar on mobile */
    function toggleNavbar(collapseID) {
        document.getElementById(collapseID).classList.toggle("hidden");
        document.getElementById(collapseID).classList.toggle("block");
      }
    /* Function for dropdowns */
    function openDropdown(event, dropdownID) {
      let element = event.target;
      while (element.nodeName !== "A") {
        element = element.parentNode;
      }
      document.getElementById(dropdownID).classList.toggle("hidden");
      document.getElementById(dropdownID).classList.toggle("block");
    }

    // Get the button
    let myButton = document.getElementById("btn-back-to-top");
    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function () {
      scrollFunction();
    };
    function scrollFunction() {
      if (
        document.body.scrollTop > 20 ||
        document.documentElement.scrollTop > 20
      ) {
        myButton.style.display = "block";
      } else {
        myButton.style.display = "none";
      }
    }
    // When the user clicks on the button, scroll to the top of the document
    myButton.addEventListener("click", backToTop);
    function backToTop() {
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    }
  </script>

  <script type="text/javascript" src="/blog/assets/javascript/bundle.js" charset="utf-8"></script>
</html>
